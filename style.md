# 코딩 스타일 가이드

이 문서는 프로젝트의 선호하는 코딩 패턴과 스타일 결정을 기록합니다. 이 문서를 수정할때는 가급적 간결하고 중복이 없도록 해야 합니다.

## 파일 관리

- **일회성 스크립트 지양**: 테스트나 검증을 위한 일회성 파이썬 코드는 파일을 새로 생성하지 않고 터미널에서 `python -c` 등을 통해 직접 실행한다.
- **불필요한 파일 생성 금지**: 프로젝트 구조를 깔끔하게 유지하기 위해 불필요한 파일 생성을 자제한다.

## 라이브러리 및 SDK

- **Anthropic SDK**: `anthropic` 라이브러리를 사용한다.
- **모델**: `claude-sonnet-4-20250514`를 기본 모델로 사용한다.

## CLI 출력 스타일

- **입력 프롬프트**: `input("켈리: ")` 형식으로 사용자 이름을 표시한다.
- **AI 응답**: `print(f"AI: {response}")` 형식으로 AI 접두사를 붙여 출력한다.

## 로깅

- **log.md**: 프로그램 실행 시 `log.md` 파일을 새로 생성(`"w"` 모드)하여 대화 내용을 기록한다.
- **기록 형식**: 각 메시지마다 역할(User/Claude/Tool->Claude/Error)과 타임스탬프를 Markdown 형식으로 기록한다.
- **기록 대상**: LLM 모델과의 데이터 교환만 기록한다. 로컬 도구 실행 내역은 기록하지 않는다.

## 도구(Function Calling)

- **스키마 분리**: 도구의 설명(JSON Schema)만 모델에 전달하고, 파이썬 코드는 노출하지 않는다.
- **자동 호출 비활성화**: 자동 도구 호출을 비활성화하고 `tool_use` / `tool_result` 패턴으로 수동으로 처리한다.
- **연쇄 호출 지원**: 모델이 여러 도구를 순차적으로 호출할 수 있도록 `while` 루프로 반복 처리한다.
- **도구 파일 패턴**: 도구 파일은 3부로 구성된다 - SCHEMA (dict) + main() 함수 + `if __name__ == "__main__"` 블록.
- **자동 로딩**: `ToolManager` 클래스가 `tools/` 폴더를 감시하여 파일 추가·수정·삭제 시 자동으로 리로드한다.

## 코드 구조

- **간결함 우선**: 별도 함수로 분리하지 않고 메인 루프에 직접 작성하여 코드를 짧게 유지한다.
- **단일 파일 시작**: 초기에는 `main.py` 하나로 시작하고, 복잡해질 때만 분리한다.

## 메모리

- **시스템 프롬프트**: `memory/instruction.md` 파일에 클로드의 시스템 프롬프트를 저장한다.
- **Memory.md**: 에이전트 메모리 개념으로 개인 정보나 기억해야 할 것들을 `Memory.md` 파일에 기록한다.
- **도구로 관리**: 에이전트가 Read/Write 도구를 통해 직접 Memory.md를 읽고 쓴다.

## 자기 확장(Self-Extending)

- **스킬 = 파이썬 파일 + 설명**: 에이전트가 새 기능이 필요하면 직접 `.py` 파일을 작성하고 실행한다.
- **도구 등록**: 새로 만든 스킬은 JSON Schema를 생성하여 다음 대화부터 도구로 사용 가능하게 한다.

## 보안

- **API 키**: 환경변수(`.env`)로만 관리하고 코드에 하드코딩하지 않는다.
- **파일 접근 제한**: 워크스페이스 외부 경로 접근을 차단한다. `save_text_file.py`의 `PROTECTED_FILES` 목록으로 중요 파일을 보호한다.
- **시스템 명령어**: 허용된 명령어만 실행한다(`shell=False`).
- **토큰 안전성**: `max_tokens` 초과 시 자동 截断(truncation) 처리로 API 오류를 방지한다.
